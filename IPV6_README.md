# ğŸŒ å‹•æ…‹ IPv6 çˆ¬èŸ²ç³»çµ±

## æ¦‚è¿°

æ­¤ç³»çµ±ç‚ºæ¯å€‹çˆ¬èŸ²ä»»å‹™åˆ†é…å”¯ä¸€çš„ IPv6 åœ°å€ï¼Œæœ‰æ•ˆé¿å… IP å°é–ï¼Œæå‡çˆ¬èŸ²æˆåŠŸç‡ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

- ğŸ”„ **å‹•æ…‹ IPv6 åˆ†é…**ï¼šæ¯å€‹çˆ¬èŸ²ä»»å‹™ä½¿ç”¨ä¸åŒçš„ IPv6 åœ°å€
- ğŸ² **éˆæ´»ç­–ç•¥**ï¼šæ”¯æ´éš¨æ©Ÿå’Œé †åºå…©ç¨®åˆ†é…ç­–ç•¥
- ğŸ“Š **æ™ºèƒ½ç®¡ç†**ï¼šè‡ªå‹•è¿½è¹¤å’Œç®¡ç†å·²ä½¿ç”¨çš„åœ°å€
- ğŸ§ª **æ¨¡æ“¬æ¨¡å¼**ï¼šåœ¨æœ¬åœ°é–‹ç™¼æ™‚ç„¡éœ€çœŸå¯¦ IPv6
- ğŸš€ **ç”Ÿç”¢å°±ç·’**ï¼šåœ¨ DigitalOcean ä¸Šé–‹ç®±å³ç”¨

## ğŸ“ æ–°å¢æª”æ¡ˆ

```
watchscrabbing/
â”œâ”€â”€ src/lib/
â”‚   â”œâ”€â”€ ipv6-config.js              # IPv6 é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ ipv6-proxy-manager.js       # IPv6 åœ°å€æ± ç®¡ç†å™¨
â”‚   â”œâ”€â”€ ipv6-system-manager.js      # ç³»çµ±ç´š IPv6 ç®¡ç†
â”‚   â”œâ”€â”€ main.js                     # å·²æ›´æ–°ï¼šæ•´åˆ IPv6 ç®¡ç†
â”‚   â””â”€â”€ YongChang.js                # å·²æ›´æ–°ï¼šç¤ºä¾‹çˆ¬èŸ²å‡½æ•¸
â”œâ”€â”€ test-ipv6.js                    # IPv6 æ¸¬è©¦è…³æœ¬
â”œâ”€â”€ setup-ipv6-pool.sh              # IPv6 åœ°å€æ± è¨­ç½®è…³æœ¬
â”œâ”€â”€ cleanup-ipv6.js                 # IPv6 æ¸…ç†è…³æœ¬
â”œâ”€â”€ DIGITALOCEAN_IPV6_SETUP.md      # DigitalOcean éƒ¨ç½²æŒ‡å—
â””â”€â”€ IPV6_README.md                  # æœ¬æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

### åœ¨æœ¬åœ°æ¸¬è©¦ï¼ˆæ¨¡æ“¬æ¨¡å¼ï¼‰

```bash
# 1. é‹è¡Œæ¸¬è©¦è…³æœ¬
node test-ipv6.js

# 2. é‹è¡Œçˆ¬èŸ²ï¼ˆæœƒä½¿ç”¨æ¨¡æ“¬ IPv6ï¼‰
node src/lib/main.js
```

### åœ¨ DigitalOcean éƒ¨ç½²

```bash
# 1. å•Ÿç”¨ IPv6ï¼ˆåœ¨ DO æ§åˆ¶å°ï¼‰
# 2. æŸ¥çœ‹æ‚¨çš„ IPv6 å‰ç¶´
ip -6 addr show

# 3. è¨­ç½®ç’°å¢ƒè®Šæ•¸
export ENABLE_IPV6=true
export IPV6_PREFIX="2604:a880:800:10"  # æ›¿æ›æˆæ‚¨çš„å‰ç¶´
export IPV6_INTERFACE="eth0"

# 4. é‹è¡Œè¨­ç½®è…³æœ¬ï¼ˆå¯é¸ï¼Œé å…ˆå‰µå»ºåœ°å€æ± ï¼‰
sudo ./setup-ipv6-pool.sh

# 5. æ¸¬è©¦é…ç½®
node test-ipv6.js

# 6. é‹è¡Œçˆ¬èŸ²
node src/lib/main.js
```

è©³ç´°æ­¥é©Ÿè«‹åƒè€ƒï¼š[DIGITALOCEAN_IPV6_SETUP.md](./DIGITALOCEAN_IPV6_SETUP.md)

## ğŸ”§ é…ç½®é¸é …

### ç’°å¢ƒè®Šæ•¸

| è®Šæ•¸ | é è¨­å€¼ | èªªæ˜ |
|------|--------|------|
| `ENABLE_IPV6` | `false` | æ˜¯å¦å•Ÿç”¨çœŸå¯¦ IPv6ï¼ˆæœ¬åœ°æ¸¬è©¦è¨­ç‚º falseï¼‰ |
| `IPV6_PREFIX` | `fd00::` | IPv6 å‰ç¶´ï¼ˆDigitalOcean ä¸Šç²å¾—çš„å‰ç¶´ï¼‰ |
| `IPV6_INTERFACE` | `eth0` | ç¶²è·¯ä»‹é¢åç¨± |
| `IPV6_POOL_SIZE` | `100` | IPv6 åœ°å€æ± å¤§å° |
| `IPV6_VERBOSE` | `false` | æ˜¯å¦é¡¯ç¤ºè©³ç´°æ—¥èªŒ |

### ä¿®æ”¹é…ç½®

**æ–¹æ³• 1ï¼šç’°å¢ƒè®Šæ•¸**
```bash
export ENABLE_IPV6=true
export IPV6_PREFIX="æ‚¨çš„å‰ç¶´"
```

**æ–¹æ³• 2ï¼š.env æ–‡ä»¶**
```env
ENABLE_IPV6=true
IPV6_PREFIX=2604:a880:800:10
IPV6_INTERFACE=eth0
IPV6_POOL_SIZE=200
```

**æ–¹æ³• 3ï¼šä¿®æ”¹ä»£ç¢¼**
ç·¨è¼¯ `src/lib/ipv6-config.js`

## ğŸ“Š å·¥ä½œåŸç†

### æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  çˆ¬èŸ²ä»»å‹™é–‹å§‹   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IPv6Manager     â”‚ â† ç”Ÿæˆå”¯ä¸€çš„ IPv6 åœ°å€
â”‚ getIpv6ForSite()â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SystemManager   â”‚ â† åœ¨ç³»çµ±ä¸Šæ·»åŠ åœ°å€
â”‚ addIpv6Address()â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä½¿ç”¨è©² IPv6     â”‚
â”‚ åŸ·è¡Œçˆ¬èŸ²        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çˆ¬èŸ²ä»»å‹™å®Œæˆ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åœ°å€åˆ†é…ç­–ç•¥

#### éš¨æ©Ÿç­–ç•¥ï¼ˆé è¨­ï¼‰
```javascript
// æ¯æ¬¡ç”Ÿæˆéš¨æ©Ÿçš„ IPv6 åœ°å€
fd00:::a1b2:c3d4:e5f6:7890
fd00:::1234:5678:9abc:def0
```

#### é †åºç­–ç•¥
```javascript
// æŒ‰é †åºç”Ÿæˆ IPv6 åœ°å€
fd00::::1
fd00::::2
fd00::::3
```

### ç¤ºä¾‹ä»£ç¢¼

åœ¨æ‚¨çš„çˆ¬èŸ²å‡½æ•¸ä¸­ä½¿ç”¨ï¼š

```javascript
import ipv6Manager from './ipv6-proxy-manager.js';
import systemManager from './ipv6-system-manager.js';

export const YourScraper = async ({page, data}) => {
  // ç‚ºé€™å€‹ä»»å‹™ç²å–ä¸€å€‹ IPv6 åœ°å€
  const ipv6 = ipv6Manager.getIpv6ForSite('YourSite', data.url);
  
  // ç¢ºä¿åœ°å€åœ¨ç³»çµ±ä¸Šå¯ç”¨
  await systemManager.addIpv6Address(ipv6);
  
  console.log(`ğŸŒ ä½¿ç”¨ IPv6: ${ipv6}`);
  
  // ç¹¼çºŒæ‚¨çš„çˆ¬èŸ²é‚è¼¯...
  await page.goto(data.url);
  // ...
}
```

## ğŸ“ˆ ç›£æ§å’Œçµ±è¨ˆ

### æŸ¥çœ‹çµ±è¨ˆä¿¡æ¯

ç¨‹å¼é‹è¡Œæ™‚æœƒè‡ªå‹•é¡¯ç¤ºï¼š

```
ğŸ“Š IPv6 ä½¿ç”¨çµ±è¨ˆï¼š
   å·²ä½¿ç”¨: 45/100
   åˆ©ç”¨ç‡: 45.00%
   è¿½è¹¤ä»»å‹™: 45
   ç•¶å‰è¨ˆæ•¸å™¨: 46
```

### æ‰‹å‹•æŸ¥è©¢

```javascript
import ipv6Manager from './src/lib/ipv6-proxy-manager.js';

// ç²å–çµ±è¨ˆ
const stats = ipv6Manager.getStats();
console.log(stats);

// é¡¯ç¤ºçµ±è¨ˆ
ipv6Manager.showStats();

// ç²å–å·²ä½¿ç”¨çš„åœ°å€åˆ—è¡¨
const addresses = ipv6Manager.getUsedIpv6List();
console.log(addresses);
```

## ğŸ§ª æ¸¬è©¦

### å®Œæ•´æ¸¬è©¦

```bash
node test-ipv6.js
```

æ¸¬è©¦åŒ…æ‹¬ï¼š
1. âœ… é…ç½®é©—è­‰
2. âœ… IPv6 åœ°å€ç”Ÿæˆï¼ˆéš¨æ©Ÿå’Œé †åºï¼‰
3. âœ… ç³»çµ±ç®¡ç†å™¨åŠŸèƒ½
4. âœ… åœ°å€å”¯ä¸€æ€§æª¢æŸ¥
5. âœ… ä»»å‹™æ˜ å°„
6. âœ… é€£æ¥æ€§æ¸¬è©¦ï¼ˆåœ¨å•Ÿç”¨æ™‚ï¼‰

### å–®ç¨æ¸¬è©¦ IPv6 é€£æ¥

```bash
# æ¸¬è©¦ç‰¹å®š IPv6 åœ°å€
curl -6 --interface 2604:a880:800:10::1 https://api64.ipify.org

# æ‡‰è©²è¿”å›è©² IPv6 åœ°å€
```

## ğŸ” èª¿è©¦

### å•Ÿç”¨è©³ç´°æ—¥èªŒ

```bash
export IPV6_VERBOSE=true
node test-ipv6.js
```

### æª¢æŸ¥ç³»çµ±ä¸Šçš„ IPv6

```bash
# æŸ¥çœ‹æ‰€æœ‰ IPv6 åœ°å€
ip -6 addr show

# åªçœ‹ç‰¹å®šå‰ç¶´
ip -6 addr show | grep "2604:a880"

# è¨ˆç®—æ•¸é‡
ip -6 addr show | grep "2604:a880" | wc -l
```

### å¸¸è¦‹å•é¡Œ

#### å•é¡Œï¼šæ¬Šé™ä¸è¶³
```bash
# è§£æ±ºæ–¹æ¡ˆ 1ï¼šä½¿ç”¨ sudo
sudo node src/lib/main.js

# è§£æ±ºæ–¹æ¡ˆ 2ï¼šçµ¦ node æ·»åŠ æ¬Šé™
sudo setcap cap_net_admin=eip $(which node)
```

#### å•é¡Œï¼šåœ°å€æ± å·²æ»¿
```bash
# å¢åŠ æ± å¤§å°
export IPV6_POOL_SIZE=200
```

#### å•é¡Œï¼šIPv6 ç„¡æ³•é€£æ¥å¤–ç¶²
```bash
# æª¢æŸ¥ IPv6 æ˜¯å¦å•Ÿç”¨
cat /proc/sys/net/ipv6/conf/all/disable_ipv6
# æ‡‰è©²æ˜¯ 0

# æª¢æŸ¥è·¯ç”±
ip -6 route show

# æ¸¬è©¦åŸºæœ¬é€£æ¥
ping6 google.com
```

## ğŸ§¹ æ¸…ç†

### æ¸…ç†æ‰€æœ‰ IPv6 åœ°å€

```bash
# ä½¿ç”¨æ¸…ç†è…³æœ¬
node cleanup-ipv6.js

# æˆ–åœ¨ä»£ç¢¼ä¸­
import systemManager from './src/lib/ipv6-system-manager.js';
await systemManager.cleanup();
```

### é‡ç½®ç®¡ç†å™¨ç‹€æ…‹

```javascript
import ipv6Manager from './src/lib/ipv6-proxy-manager.js';

// é‡ç½®æ‰€æœ‰ç‹€æ…‹
ipv6Manager.reset();
```

## ğŸ“¦ ç›¸ä¾å¥—ä»¶

æ‰€éœ€çš„ npm å¥—ä»¶ï¼š
- `puppeteer` æˆ– `puppeteer-core` ï¼ˆå·²æœ‰ï¼‰
- `puppeteer-cluster` ï¼ˆå·²æœ‰ï¼‰

## ğŸ¯ æ•ˆèƒ½è€ƒé‡

### åœ°å€æ± å¤§å°å»ºè­°

| çˆ¬èŸ²è¦æ¨¡ | å»ºè­°æ± å¤§å° | èªªæ˜ |
|---------|-----------|------|
| å°å‹ï¼ˆ<100 URLï¼‰ | 50 | è¶³å¤ ä½¿ç”¨ |
| ä¸­å‹ï¼ˆ100-1000ï¼‰ | 100-200 | é è¨­é…ç½® |
| å¤§å‹ï¼ˆ>1000ï¼‰ | 500+ | å¯æ ¹æ“šéœ€è¦èª¿æ•´ |

### è¨˜æ†¶é«”ä½¿ç”¨

- æ¯å€‹ IPv6 åœ°å€ç´„ä½”ç”¨ ~50 bytes
- 100 å€‹åœ°å€ â‰ˆ 5KB
- å¯ä»¥å®‰å…¨ä½¿ç”¨æ•¸åƒå€‹åœ°å€

## ğŸš€ é€²éšç”¨æ³•

### ç‚ºä¸åŒç¶²ç«™ä½¿ç”¨å›ºå®š IPv6

```javascript
const siteIpv6Map = {
  'YC': 'fd00::::10',
  'TT': 'fd00::::20',
  'emc2': 'fd00::::30',
};

const ipv6 = siteIpv6Map[siteCode];
```

### å¯¦ç¾ IP è¼ªæ›

```javascript
// æ¯ N å€‹è«‹æ±‚å¾Œåˆ‡æ› IP
let requestCount = 0;
const ROTATE_AFTER = 10;

if (requestCount++ % ROTATE_AFTER === 0) {
  ipv6Manager.reset(); // é‡æ–°é–‹å§‹åˆ†é…
}
```

### èˆ‡ä»£ç†çµåˆä½¿ç”¨

å¦‚æœéœ€è¦æ›´é«˜ç´šçš„åŠŸèƒ½ï¼Œå¯ä»¥çµåˆ SOCKS5 ä»£ç†ä½¿ç”¨ã€‚

## ğŸ“ æŠ€è¡“æ”¯æ´

é‡åˆ°å•é¡Œï¼Ÿ

1. å…ˆé‹è¡Œ `node test-ipv6.js` è¨ºæ–·
2. æŸ¥çœ‹ [DIGITALOCEAN_IPV6_SETUP.md](./DIGITALOCEAN_IPV6_SETUP.md)
3. æª¢æŸ¥ç³»çµ±æ—¥èªŒï¼š`/var/log/syslog`

## ğŸ“„ æˆæ¬Š

èˆ‡ä¸»å°ˆæ¡ˆç›¸åŒçš„æˆæ¬Šã€‚

## ğŸ‰ é–‹å§‹ä½¿ç”¨

```bash
# æœ¬åœ°æ¸¬è©¦
node test-ipv6.js

# DigitalOcean éƒ¨ç½²
# 1. å•Ÿç”¨ IPv6
# 2. è¨­ç½®ç’°å¢ƒè®Šæ•¸
# 3. é‹è¡Œ sudo ./setup-ipv6-pool.sh
# 4. é–‹å§‹çˆ¬èŸ²ï¼

node src/lib/main.js
```

ç¥æ‚¨çˆ¬èŸ²é †åˆ©ï¼ğŸš€

